<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Moradoras - República 804</title>
    <link rel="icon" type="image/png" href="/imagens/logo.jpeg">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="republica-body">

    <nav class="glass-nav">
        <div class="logo">
            <img src="/imagens/logo.jpeg" alt="Logo">
            <span>República do 804</span>
        </div>
        <div class="nav-links">
            <a href="/">Cálculo</a>
            <a href="/galeria">Momentos</a>
            <a href="/moradoras" class="active">Moradoras</a>
            <a href="/historico">Histórico</a>
            <a href="/estatisticas">Estatísticas</a>
        </div>
    </nav>

    <main class="container">
        <div style="margin-bottom: 30px; text-align: center;">
            <h2 class="section-title">Moradoras</h2>
        </div>

        <div class="moradoras-grid">
            <% moradoras.forEach(m => { %>
                <div class="moradora-card <%= m.status === 'Inativo' ? 'inativo' : '' %>" style="position: relative; overflow: hidden;">
                    
                    <button onclick="toggleForm('edit-<%= m.id %>')" class="btn-edit-floating" style="position: absolute; top: 10px; right: 10px; border: none; background: var(--accent-color); color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; z-index: 5;">
                        <i class="fa fa-pencil"></i>
                    </button>

                    <div id="edit-<%= m.id %>" class="edit-overlay" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 10; padding: 15px; box-sizing: border-box;">
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="font-size: 0.9rem; margin: 0;">Editar: <%= m.nome %></h4>
                            
                            <form action="/moradoras/deletar/<%= m.id %>" method="POST" onsubmit="return confirm('Deseja realmente excluir esta moradora do sistema?')">
                                <button type="submit" style="background: none; border: none; color: #e74c3c; cursor: pointer;" title="Excluir Moradora">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </form>
                        </div>

                        <form action="/moradoras/editar/<%= m.id %>" method="POST" style="display: flex; flex-direction: column; gap: 8px;">
                            <select name="status" style="padding: 4px; font-size: 0.8rem;">
                                <option value="Ativo" <%= m.status === 'Ativo' ? 'selected' : '' %>>Ativo</option>
                                <option value="Inativo" <%= m.status === 'Inativo' ? 'selected' : '' %>>Inativo</option>
                            </select>
                            <input type="text" name="saida" value="<%= m.saida %>" placeholder="Data Saída" style="padding: 4px; font-size: 0.8rem;">
                            <input type="email" name="email" value="<%= m.email %>" placeholder="E-mail" style="padding: 4px; font-size: 0.8rem;">
                            <input type="text" name="celular" value="<%= m.celular %>" placeholder="Celular" style="padding: 4px; font-size: 0.8rem;">
                            <input type="text" name="pais" value="<%= m.pais %>" placeholder="Pais" style="padding: 4px; font-size: 0.8rem;">
                            <input type="text" name="foto" value="<%= m.foto %>" placeholder="Caminho da Foto" style="padding: 4px; font-size: 0.8rem;">
                            
                            <div style="display: flex; gap: 5px; margin-top: 5px;">
                                <button type="submit" class="btn-primary" style="flex: 1; padding: 5px; font-size: 0.8rem;">Salvar</button>
                                <button type="button" onclick="toggleForm('edit-<%= m.id %>')" style="flex: 1; padding: 5px; font-size: 0.8rem;">Cancelar</button>
                            </div>
                        </form>
                    </div>

                    <div class="foto-container">
                        <img src="<%= m.foto %>" alt="<%= m.nome %>" class="foto-moradora">
                    </div>
                    <div class="info-moradora">
                        <h3><%= m.nome %></h3>
                        <p><strong>Curso:</strong> <%= m.curso %></p>
                        <p><strong>Período:</strong> <%= m.entrada %> — <%= m.saida %></p>
                        
                        <div class="contatos-moradora">
                            <p title="E-mail"><i class="fa fa-envelope"></i> <%= m.email %></p>
                            <p title="Celular"><i class="fa fa-phone"></i> <%= m.celular %></p>
                            <p title="Contato Pais" class="contato-pais"><i class="fa fa-users"></i> Pais: <%= m.pais %></p>
                        </div>

                        <p class="desc"><%= m.info %></p>
                    </div>
                </div>
            <% }) %>
        </div>

        <div style="margin-top: 50px; text-align: center; padding-bottom: 50px;">
            <button id="btn-show-add" onclick="toggleForm('form-add')" class="btn-primary" style="padding: 12px 25px; width: auto;">
                <i class="fa fa-user-plus"></i> Adicionar Nova Moradora
            </button>

            <section id="form-add" class="glass-card" style="display:none; margin-top: 30px; padding: 25px; text-align: left;">
                <h3 style="margin-bottom: 20px; color: var(--accent-color);">Cadastrar Nova Moradora</h3>
                <form action="/moradoras/adicionar" method="POST" enctype="multipart/form-data">
                    <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <input type="text" name="nome" placeholder="Nome Completo" required>
                        <select name="status">
                            <option value="Ativo">Status: Ativo</option>
                            <option value="Inativo">Status: Inativo</option>
                        </select>
                        <input type="text" name="curso" placeholder="Curso">
                        <input type="text" name="entrada" placeholder="Data Entrada (Ex: 08/2022)">
                        
                        <div style="display: flex; flex-direction: column;">
                            <label style="font-size: 0.75rem; margin-bottom: 5px; color: #666;">Foto do Computador:</label>
                            <input type="file" name="foto_arquivo" accept="image/*" style="font-size: 0.8rem;">
                        </div>

                        <input type="email" name="email" placeholder="E-mail">
                        <input type="text" name="celular" placeholder="Celular (WhatsApp)">
                        <input type="text" name="pais" placeholder="Contato dos Pais">
                    </div>
                    <textarea name="info" placeholder="Informações Adicionais (Ex: Quarto, Observações)" style="width: 100%; margin-top: 15px; height: 80px; padding: 10px; border-radius: 5px; border: 1px solid #ddd;"></textarea>
                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button type="submit" class="btn-primary" style="width: auto;">Salvar Cadastro</button>
                        <button type="button" onclick="toggleForm('form-add')" class="btn-secondary" style="background: none; border: 1px solid #ccc; width: auto; padding: 10px 20px; cursor: pointer;">Cancelar</button>
                    </div>
                </form>
            </section>
        </div>
    </main>

    <script>
        function toggleForm(id) {
            const form = document.getElementById(id);
            const btnAdd = document.getElementById('btn-show-add');
            
            if (form.style.display === 'none' || form.style.display === '') {
                form.style.display = 'block';
                // Se for o formulário de adicionar, esconde o botão principal e rola a tela
                if (id === 'form-add') {
                    if (btnAdd) btnAdd.style.display = 'none';
                    setTimeout(() => {
                        form.scrollIntoView({ behavior: 'smooth' });
                    }, 100);
                }
            } else {
                form.style.display = 'none';
                if (id === 'form-add' && btnAdd) {
                    btnAdd.style.display = 'inline-block';
                }
            }
        }
    </script>
</body>
</html>